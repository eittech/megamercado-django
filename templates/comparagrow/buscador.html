{% extends 'comparagrow/porto/base.html' %}
{% load static %}


{% block content %}
<style media="screen">
	.card:hover{
		border:1px solid #01b22c !important;
		border-radius: inherit !important;
		/* box-shadow: 0.1px 0.1px 0.1px #7777 !important; */
		cursor:pointer;
	}
</style>

			<script>
				function enviarFiltros(filtro,valor){
					document.getElementById(filtro).value = valor;
					$('#formulario_filtro').submit();
				}
				function checkboxFilter(filtro){
					if($(filtro).is(':checked')){
						$(filtro).attr('checked', false);
					}else{
						$(filtro).attr('checked', true);
					}
					$('#formulario_filtro').submit();
				}
			</script>

			<div class="container-fluid">
				<div class="row">
					<div class="col-sm-12 col-md-2" style="border-right: 0.5px solid #f6f6f6;margin-right: 0px;">
						<h4 style="margin-top:15px;font-weight: 200;">FILTRAR POR</h4>
						<h6 style="margin-top:15px;color:#01b22c;font-weight: 300;">PRECIO</h6>
						<!-- <form id="formulario_filtro" method="get" action="{{ pagina }}{{ pagina_shop }}"> -->
							<form id="formulario_filtro" method="post" action="">

							{% csrf_token %}
							<input type="hidden" name="tienda" id="tienda_form_id" value="{{ tienda }}">
							<input type="hidden" name="categoria" id="categoria_form_id" value="{{ categoria }}">
							<input type="hidden" name="texto" id="texto_form_id" value="{{ texto }}">
							<input type="hidden" name="marca" id="marca_form_id" value="{{ marca }}">
							<input type="hidden" name="page" id="page_id" value="{{ productos.number }}">
							<input type="hidden" name="order_by" id="order_by_id" value="min">
							<div class="form-check mb-2" style="display: flex;margin-left: -5px">
						  <input type="text" name="min_price" value="{{ min_price }}" style="font-size:12px; width:72px;" class="form-control mb-2 mr-sm-2" id="inlineFormInputPriceMin" placeholder="Min">
							 <input type="text" name="max_price" value="{{ max_price }}" style="font-size:12px; width:72px;" class="form-control mb-2 mr-sm-2" id="inlineFormInputPriceMax" placeholder="Max">
							</div>
							<button type="submit" style="font-size:12px;background:#672d93;border-color:#672d93;margin-left: 15px;width: calc(100% - 15px);" class="btn btn-primary mb-2">
								<i class="fas fa-cannabis"></i> Filtrar</button>

							<h6 style="margin-top:15px;color:#01b22c;font-weight: 300;">CATEGORIAS</h6>
							{% if categorias.count > 5 %}
								<ul style="
								overflow: auto;
								height: 139px;
								font-size: 14px;
					font-family: sans-serif;
					font-weight: 100;
					list-style: none;
					margin-left: -25px;
	">
							{% else %}
							<ul style="
							font-size: 14px;
				font-family: sans-serif;
				font-weight: 100;
				list-style: none;
				margin-left: -25px;
">
							{% endif %}
							{% for category in categorias %}


								<li class="p-b-6">
								{% if category.category__pk in categoria %}
								<a class="filter-link stext-106 trans-04 filter-link-active" style="display:flex;width: max-content;"><input onclick="enviarFiltros('categoria_form_id','{{ category.category__pk }}')" type="checkbox" name="checkbox_categoria[]" value="{{ category.category__pk }}" checked style="margin-right: 5px;margin-top: 5px;">
									{{ category.category__name }} ({{ category.dcount }})</a>
								{% else %}
								<a class="filter-link stext-106 trans-04" style="display:flex;width: max-content;"><input onclick="enviarFiltros('categoria_form_id','{{ category.category__pk }}')" type="checkbox" name="checkbox_categoria[]" value="{{ category.category__pk }}" style="margin-right: 5px;margin-top: 5px;">
									{{ category.category__name }} ({{ category.dcount }})</a>
								{% endif %}
								</li>
								{% endfor %}
							</ul>
							<h6 style="margin-top:15px;color:#01b22c;font-weight: 300;">TIENDAS</h6>

							{% if tiendas.count > 5 %}
							<ul style="
							font-size: 14px;
				font-family: sans-serif;
				font-weight: 100;
				list-style: none;
				margin-left: -25px;
	">
							{% else %}
							<ul style="
							font-size: 14px;
				font-family: sans-serif;
				font-weight: 100;
				list-style: none;
				margin-left: -25px;
	">
							{% endif %}
								{% for shop in tiendas %}
								{% if forloop.counter < 6 %}
								<li class="p-b-6">
								{% if shop.shop__pk in tienda %}
								<a class="filter-link stext-106 trans-04 filter-link-active" style="display:flex;width: max-content;"><input onclick="checkboxFilter('#checkbox_shop_{{ forloop.counter }}')" type="checkbox" value="{{ shop.shop__pk }}" checked style="margin-right: 5px;margin-top: 5px;">
									{{ shop.shop__name }}  ({{ shop.dcount }})
								</a>
								{% else %}
								<a class="filter-link stext-106 trans-04" style="display:flex;width: max-content;"><input onclick="checkboxFilter('#checkbox_shop_{{ forloop.counter }}')" type="checkbox" value="{{ shop.shop__pk }}" style="margin-right: 5px;margin-top: 5px;">
									{{ shop.shop__name }} ({{ shop.dcount }})
								</a>
								{% endif %}
								</li>
								{% endif %}

								{% endfor %}
								<li>
									<button type="button" data-toggle="modal" data-target="#shoplistmodal" style="font-size:12px;background:#672d93;border-color:#672d93;width:100%;" class="btn btn-primary mb-2"><i class="fas fa-cannabis"></i> Ver todas</button></li>

							</ul>
							<div class="modal fade" id="shoplistmodal" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
								<div class="modal-dialog modal-lg">
									<div class="modal-content">
										<div class="modal-header">
											<h4 class="modal-title" id="largeModalLabel">Lista de Tiendas</h4>
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										</div>
										<div class="modal-body">
											<div class="row">
											{% for shop in tiendas %}

											<div class="col-sm-3">
											{% if shop.shop__pk in tienda %}
											<a class="filter-link stext-106 trans-04 filter-link-active" style="display:flex;width: max-content;">
												<input type="checkbox" id="checkbox_shop_{{ forloop.counter }}" name="checkbox_shop[]" value="{{ shop.shop__pk }}" checked style="margin-right: 5px;margin-top: 5px;">
												{{ shop.shop__name }}  ({{ shop.dcount }})
											</a>
											{% else %}
											<a class="filter-link stext-106 trans-04" style="display:flex;width: max-content;">
												<input type="checkbox" id="checkbox_shop_{{ forloop.counter }}" name="checkbox_shop[]" value="{{ shop.shop__pk }}" style="margin-right: 5px;margin-top: 5px;">
												{{ shop.shop__name }} ({{ shop.dcount }})
											</a>
											{% endif %}
											</div>
											{% endfor %}
										</div>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-light" data-dismiss="modal"
											style="    background-color: #01b22c;
	    border: #01b22c;
	    color: #fff;">Cerrar</button>
											<button type="submit" class="btn btn-light"
											style="    background-color: #672d93;
	    border: #672d93;
	    color: #fff;">Filtrar</button>
										</div>
									</div>
								</div>
							</div>
							<h6 style="margin-top:15px;color:#01b22c;font-weight: 300;">MARCAS</h6>

							{% if marcas.count > 5 %}
							<ul style="
							font-size: 14px;
				font-family: sans-serif;
				font-weight: 100;
				list-style: none;
				margin-left: -25px;
	">
							{% else %}
							<ul style="
							font-size: 14px;
				font-family: sans-serif;
				font-weight: 100;
				list-style: none;
				margin-left: -25px;
	">
							{% endif %}
								{% for marc in marcas %}
								{% if forloop.counter < 6 %}

								{% if marc.brand == "" %}

								{% else %}
								<li class="p-b-6">
								{% if marc.brand in marca %}
								<a class="filter-link stext-106 trans-04 filter-link-active" style="display:flex;width: max-content;"><input onclick="checkboxFilter('#checkbox_marca_{{ forloop.counter }}')" type="checkbox" value="{{ marc.brand }}" checked style="margin-right: 5px;margin-top: 5px;">
									{{ marc.brand }} ({{ marc.dcount }})
								</a>
								{% else %}
								<a class="filter-link stext-106 trans-04" style="display:flex;width: max-content;"><input onclick="checkboxFilter('#checkbox_marca_{{ forloop.counter }}')" type="checkbox"  value="{{ marc.brand }}" style="margin-right: 5px;margin-top: 5px;">
									{{ marc.brand }} ({{ marc.dcount }})
								</a>
								{% endif %}
								</li>
								{% endif %}
								{% endif %}

								{% endfor %}
								<li>
									<button type="button" data-toggle="modal" data-target="#brandlistmodal" style="font-size:12px;background:#672d93;border-color:#672d93;width:100%;" class="btn btn-primary mb-2"><i class="fas fa-cannabis"></i> Ver todas</button></li>
							</ul>

							<div class="modal fade" id="brandlistmodal" tabindex="-1" role="dialog" aria-labelledby="largeModalLabel" aria-hidden="true">
								<div class="modal-dialog modal-lg">
									<div class="modal-content">
										<div class="modal-header">
											<h4 class="modal-title" id="largeModalLabel">Lista de Marcas</h4>
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										</div>
										<div class="modal-body">
											<div class="row">
												{% for marc in marcas %}
												{% if marc.brand == "" %}

												{% else %}
												{% if marc.brand in marca %}
												<div class="col-sm-3">

												<a class="filter-link stext-106 trans-04 filter-link-active" style="display:flex;width: max-content;"><input type="checkbox" id="checkbox_marca_{{ forloop.counter }}" name="checkbox_marca[]" value="{{ marc.brand }}" checked style="margin-right: 5px;margin-top: 5px;">
													{{ marc.brand }} ({{ marc.dcount }})
												</a>
											</div>

												{% else %}
												<div class="col-sm-3">

												<a class="filter-link stext-106 trans-04" style="display:flex;width: max-content;"><input type="checkbox" id="checkbox_marca_{{ forloop.counter }}" name="checkbox_marca[]" value="{{ marc.brand }}" style="margin-right: 5px;margin-top: 5px;">
													{{ marc.brand }} ({{ marc.dcount }})
												</a>
											</div>

												{% endif %}
												{% endif %}
												{% endfor %}
										</div>
										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-light" data-dismiss="modal"
											style="    background-color: #01b22c;
	    border: #01b22c;
	    color: #fff;">Cerrar</button>
											<button type="submit" class="btn btn-light"
											style="    background-color: #672d93;
	    border: #672d93;
	    color: #fff;">Filtrar</button>
										</div>
									</div>
								</div>
							</div>
							</form>

					</div> <!-- col.// -->
					<div class="col-sm-12 col-md-10">
						<div class="row">
							<div class="col-sm-12 col-md-6">

								<h4 style="margin-top:15px; font-weight: 200;">
								{{ texto }}
								</h4>
							</div>
							<div class="col-sm-12 col-md-6 text-right">
								<div class="btn-group" role="group" style="
    margin-right: 30px;
    margin-top: 10px;
">
<label for="" style="
margin-top: 6px;
margin-right: 9px;
font-weight: 100;
">Ordenar por: </label>
							    <button id="btnGroupDrop1" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="
    border-top-left-radius: 0;
		background-color: #01b22c;
		border:#01b22c;
		color:#fff;
		font-weight: 100;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-top-right-radius: 0;
">
							      {% if order_by == "min" %}Menor precio de primero{% endif %}
										{% if order_by == "max" %}Mayor precio de primero{% endif %}
										{% if order_by == "dest" %}Destacados de primero{% endif %}
							    </button>
							    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
										<a class="dropdown-item" onclick="enviarFiltros('order_by_id','min')">Menor precio de primero</a>
							      <a class="dropdown-item" onclick="enviarFiltros('order_by_id','max')">Mayor precio de primero</a>
										<a class="dropdown-item" onclick="enviarFiltros('order_by_id','dest')">Destacados de primero</a>
							    </div>
							  </div>
							</div>
						</div>
						<div class="row">
							<h4 style="margin-top:5px;margin-left:15px;font-size:12px; font-weight: 200;">Mostrando {{ productos.paginator.count }} Productos </h4>
						</div>
						<div class="row">
							<div class="col article-feed">
									{% include 'comparagrow/component/items_buscador.html' %}
							</div>
						</div>
					</div> <!-- col.// -->
				</div>

			</div> <!-- container .//  -->

	<!-- ========================= SECTION CONTENT END// ========================= -->
{% endblock %}


{% block js %}
<script src="/static/js/notify.js"></script>
<script src="/static/js/infinite-scroll.pkgd.min.js"></script>
<script type="text/javascript">
  $('.article-feed').infiniteScroll({
    path: '.pagination__next',
    append: '.article',
    status: '.scroller-status',
    hideNav: '.pagination',
  });
</script>
<script>
	function FavoriteProduct(id){
		$.ajax({
      method: "GET",
      url: "/productos/favorito/"+id,
    })
      .done(function( msg ) {
          $.notify(msg.text, msg.status);
					console.log(msg.type)
					if(msg.type=="add"){
						console.log('add');
						console.log('#favorite_'+id);
						$('#favorite_'+id).removeClass("fas fa-heart");
						$('#favorite_'+id).addClass("far fa-heart");
					}
					if(msg.type=="del"){
						console.log('del');
						console.log('#favorite_'+id);
						$('#favorite_'+id).removeClass("far fa-heart");
						$('#favorite_'+id).addClass("fas fa-heart");
					}
					if(msg.type=="not"){
						console.log('not');
						console.log('#favorite_'+id);
					}
    });

	}
</script>
{% endblock %}
